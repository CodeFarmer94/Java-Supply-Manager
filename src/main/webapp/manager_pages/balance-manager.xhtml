<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets">

<f:view>
	<f:metadata>


	</f:metadata>
	<ui:composition template="/WEB-INF/templates/main-template.xhtml">
		<ui:define name="right-panel">

			<h:body>
				<h:form id="form">
					<!-- CATCHING FACE MESSAGES -->
					<p:growl id="messages" showDetail="true" />

					<p:panel header="Financial Summary" id="financial-summary">
						<p:panel header="Balance Statistics">
							<div class="field">
								<i class="pi pi-money-bill icon"></i>
								<p:outputLabel id="balanceAmount"
									value="Balance: $#{balanceBean.currentBalance != null ? balanceBean.currentBalance.balanceAmount : 'N/A'}" />
							</div>
							<div class="field">
								<i class="pi pi-calendar icon"></i>
								<p:outputLabel id="lastUpdated"
									value="Last Update: #{balanceBean.currentBalance != null ? balanceBean.getLastUpdateDate() : 'N/A'}" />
							</div>

						</p:panel>


						<!--
            <p:outputLabel value="Monthly Expenses: #{balanceTaskManagerBean.monthlyExpenses}" />
            <p:outputLabel value="Yearly Expenses: #{balanceTaskManagerBean.yearlyExpenses}" />
			-->

						<p:panel header="Add Funds">
							<p:outputLabel for="@next" value="Add Funds to Balance" />
							<p:commandButton value="Open"
								action="#{balanceTaskManagerBean.addFunds}"
								onclick="PF('createDialog').show()" style="margin-left:1rem"/>

						</p:panel>

					</p:panel>
					
        <p:panel header="Transaction History">
            <p:dataTable var="balance" value="#{balanceBean.balanceList}" paginator="true" paginatorPosition="bottom" id="balanceTable" rows="5">
               
                <p:column headerText="ID">
                   	<h:outputText value="#{balance.id}"/>
                </p:column>
                <p:column headerText="Amount">
                   	<h:outputText value="#{balance.balanceAmount}"/>
                </p:column>
                
                <p:column headerText="Type">
                   	<h:outputText value="#{balance.transactionType}"/>
                </p:column>
                
                <p:column headerText="Date">
                   	<h:outputText value="#{balanceBean.getDateAsString(balance.createdAt)}"/>
                </p:column>
            </p:dataTable>
        </p:panel> 
				</h:form>

				<!-- MANAGE DIALOG -->
				<h:form id="dialogs">
					<p:dialog showEffect="fade" modal="true" widgetVar="createDialog"
						responsive="true">
						<f:facet name="header">
							<ui:insert name="header" /> Add funds
                </f:facet>
						<!-- DIALOG PANEL -->
						<p:outputPanel id="create-panel" class="ui-fluid"
							style="display: flex; flex-direction: column; gap: 15px;">

							<div class="field">
								<p:outputLabel value="Funds to Add: " for="@next" />
								<p:spinner id="prefix" value="#{balanceBean.fundsToAdd}"
									prefix="$" min="0" />

							</div>


						</p:outputPanel>


						<f:facet name="footer">
							<p:commandButton value="Add" icon="pi pi-check"
								action="#{balanceBean.addFunds}"
								update="form:messages dialogs:create-panel"
								process="@this :dialogs:create-panel" />

							<p:commandButton value="Reset" update="create-panel"
								process="@this" styleClass="mr-2 ui-button-outlined">
								<p:resetInput target="create-panel" />
							</p:commandButton>
							<p:commandButton value="Cancel" icon="pi pi-times"
								onclick="PF('createDialog').hide()" class="ui-button-secondary"
								type="button" />
						</f:facet>
					</p:dialog>
				</h:form>
			</h:body>
		</ui:define>
	</ui:composition>
</f:view>

</html>
